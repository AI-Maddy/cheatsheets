**cheat sheet** for the **Linux V4L2** (Video4Linux2) framework ‚Äî focused on the most common patterns used in 2024‚Äì2025 (kernel 6.x era).

‚öôÔ∏è Quick Command-line Exploration Tools

Tool          | Most useful commands (run as normal user or with sudo)
--------------|------------------------------------------------------
``v4l2-ctl``    | ``--list-devices``<br>``--device /dev/video0 --all``<br>``--list-formats-ext``<br>``--list-ctrls``<br>``--list-formats``<br>``--get-fmt-video``
``v4l2-compliance`` | ``--device /dev/video0``  (very strict compliance checker)
``media-ctl``   | ``-p``  (print media controller graph)<br>``--print-topology``

üìå Typical User-Space Capture Sequence (most common today)

.. code-block:: c

fd = open("/dev/video0", O_RDWR);

// 1. Check capabilities
struct v4l2_capability cap;
ioctl(fd, VIDIOC_QUERYCAP, &cap);               // ‚Üí cap.capabilities & cap.device_caps

// 2. Choose & set pixel format + size
struct v4l2_format fmt = {0};
fmt.type = V4L2_BUF_TYPE_VIDEO_CAPTURE(_MPLANE);
fmt.fmt.pix.pixelformat = V4L2_PIX_FMT_MJPEG;   // or YUYV, NV12, etc.
fmt.fmt.pix.width  = 1920;
fmt.fmt.pix.height = 1080;
ioctl(fd, VIDIOC_S_FMT, &fmt);                  // driver may change values ‚Üí read back

// 3. Request MMAP buffers (most common & fastest method)
struct v4l2_requestbuffers req = {0};
req.count  = 4;                                 // usually 3‚Äì8
req.type   = V4L2_BUF_TYPE_VIDEO_CAPTURE;
req.memory = V4L2_MEMORY_MMAP;
ioctl(fd, VIDIOC_REQBUFS, &req);

// 4. Query & mmap each buffer
struct v4l2_buffer buf = {0};
for (int i = 0; i < req.count; i++) {
    buf.type   = req.type;
    buf.memory = req.memory;
    buf.index  = i;
    ioctl(fd, VIDIOC_QUERYBUF, &buf);
    void *ptr = mmap(NULL, buf.length, PROT_READ|PROT_WRITE, MAP_SHARED, fd, buf.m.offset);
}

// 5. Queue all buffers
for (int i = 0; i < req.count; i++) {
    buf.index = i;
    ioctl(fd, VIDIOC_QBUF, &buf);
}

// 6. Start streaming
enum v4l2_buf_type type = V4L2_BUF_TYPE_VIDEO_CAPTURE;
ioctl(fd, VIDIOC_STREAMON, &type);

// 7. Main loop: dequeue ‚Üí process ‚Üí re-queue
while (running) {
    fd_set fds; FD_ZERO(&fds); FD_SET(fd, &fds);
    select(fd+1, &fds, NULL, NULL, &tv);

    ioctl(fd, VIDIOC_DQBUF, &buf);               // blocks or returns EAGAIN
    // process data at buffers[buf.index]
    ioctl(fd, VIDIOC_QBUF, &buf);
}

// 8. Stop
ioctl(fd, VIDIOC_STREAMOFF, &type);

// 9. Cleanup
close(fd);

‚≠ê üìö Most Important V4L2 ioctls (Quick Reference Table)

Category               | ioctl                          | Main arg struct                  | Purpose / Notes
-----------------------|--------------------------------|----------------------------------|-----------------------
Capabilities           | ``VIDIOC_QUERYCAP``              | ``v4l2_capability``                | Must call first ‚Äî read ``capabilities``, ``device_caps``, ``card``, ``driver``
Format                 | ``VIDIOC_ENUM_FMT``              | ``v4l2_fmtdesc``                   | List supported pixelformats (index++)
Format                 | ``VIDIOC_G_FMT`` / ``VIDIOC_S_FMT``| ``v4l2_format``                    | Get / set width/height/pixelformat/field/‚Ä¶
Format                 | ``VIDIOC_TRY_FMT``               | ``v4l2_format``                    | Dry-run (does not commit)
Buffers                | ``VIDIOC_REQBUFS``               | ``v4l2_requestbuffers``            | count=0 ‚Üí free, count>0 ‚Üí alloc
Buffers                | ``VIDIOC_QUERYBUF``              | ``v4l2_buffer``                    | Get buffer info (length, offset for mmap)
Buffers                | ``VIDIOC_QBUF`` / ``VIDIOC_DQBUF`` | ``v4l2_buffer``                    | Queue / Dequeue (index or buffer ptr)
Streaming              | ``VIDIOC_STREAMON`` / ``STREAMOFF``| ``v4l2_buf_type`` (enum)           | Start / stop streaming
Controls               | ``VIDIOC_QUERYCTRL``             | ``v4l2_queryctrl``                 | Enumerate controls (index++)
Controls               | ``VIDIOC_(G|S)_CTRL``            | ``v4l2_control``                   | Read/write old-style 32-bit controls
Controls (ext)         | ``VIDIOC_(G|S|QUERY)_EXT_CTRLS`` | ``v4l2_ext_controls``              | Modern way ‚Äî arrays, 64-bit, volatile/‚Ä¶
Input/Output           | ``VIDIOC_ENUMINPUT`` / ``G/S_INPUT`` | ``v4l2_input`` / int             | Cameras usually have only 1
Crop/Selection         | ``VIDIOC_(G|S)_SELECTION``       | ``v4l2_selection``                 | Crop, compose, native size (target = V4L2_SEL_*)
Frame intervals        | ``VIDIOC_ENUM_FRAMEINTERVALS``   | ``v4l2_frmivalenum``               | List supported FPS for given resolution
Events                 | ``VIDIOC_SUBSCRIBE_EVENT``       | ``v4l2_event_subscription``        | SOURCE_CHANGE, CTRL, FRAME_SYNC, ‚Ä¶
Events                 | ``VIDIOC_DQEVENT``               | ``v4l2_event``                     | Read events (non-blocking or with poll)

üìå Most Common Pixel Formats (fourcc)

FourCC     | Description                        | Typical usage
-----------|------------------------------------|-------------------------------
``MJPG`` / ``MJPG`` | Motion JPEG                     | USB webcams, low bandwidth
``YUYV`` / ``YUY2`` | YUYV 4:2:2 packed              | Many cheap cameras
``NV12``      | Y + interleaved UV (4:2:0)         | Hardware encoders, modern mobile/embedded
``NV21``      | Y + interleaved VU                 | Android camera HAL
``YUYV`` / ``YUY2`` | ‚Üí most universal fallback
``RGB3`` / ``RGBP`` | 24-bit RGB                         | uncompressed preview
``XR24`` / ``RGBA`` | 32-bit RGBA                        | GUI / OpenGL

üíª Quick v4l2-ctl Examples

.. code-block:: bash

================================================================================
üîß Show everything about device
================================================================================

.. contents:: üìë Quick Navigation
   :depth: 2
   :local:



v4l2-ctl -d /dev/video0 --all

================================================================================
‚öôÔ∏è List supported formats + resolutions
================================================================================

v4l2-ctl --list-formats-ext

================================================================================
üíæ Capture one JPEG frame
================================================================================

v4l2-ctl --set-fmt-video=width=1280,height=720,pixelformat=MJPG \
         --stream-mmap --stream-to=snapshot.jpg --stream-count=1

================================================================================
List all controls
================================================================================

v4l2-ctl --list-ctrls

================================================================================
Set brightness & disable auto-exposure
================================================================================

v4l2-ctl -c brightness=120 -c exposure_auto=1 -c exposure_auto_priority=0 -c exposure_absolute=200

================================================================================
üì° Show media topology (very useful for complex SoC cameras)
================================================================================

media-ctl -p -d /dev/media0

üêß Kernel Side ‚Äî Quick Driver Skeleton Reminders

.. code-block:: c

// Most common nowadays
#include <media/videobuf2-v4l2.h>
#include <media/v4l2-dev.h>
#include <media/v4l2-device.h>
#include <media/v4l2-ctrls.h>
#include <media/v4l2-ioctl.h>      // or use v4l2_ioctl_ops

struct my_ctx {
    struct v4l2_device          v4l2_dev;
    struct v4l2_ctrl_handler    hdl;
    struct video_device         vdev;
    struct vb2_queue            vb2_q;
    /* ... */
};

static const struct v4l2_ioctl_ops ioctl_ops = {
    .vidioc_querycap      = my_querycap,
    .vidioc_enum_fmt_vid_cap  = my_enum_fmt,
    .vidioc_g_fmt_vid_cap     = my_g_fmt,
    .vidioc_s_fmt_vid_cap     = my_s_fmt,
    .vidioc_reqbufs           = vb2_ioctl_reqbufs,
    .vidioc_querybuf          = vb2_ioctl_querybuf,
    .vidioc_qbuf              = vb2_ioctl_qbuf,
    .vidioc_dqbuf             = vb2_ioctl_dqbuf,
    .vidioc_streamon          = vb2_ioctl_streamon,
    .vidioc_streamoff         = vb2_ioctl_streamoff,
    /* .vidioc_(g|s)_ctrl     = ... or use ctrl_handler */
};

üü¢ üü¢ Good luck with your V4L2 project!

================================================================================

**Last updated:** January 2026

================================================================================

**Last updated:** January 2026

================================================================================

**Last updated:** January 2026
